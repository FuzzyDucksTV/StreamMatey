/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!************************!*\
  !*** ./src/options.js ***!
  \************************/
document.addEventListener('DOMContentLoaded', function (event) {
  var features = {
    sentiment: {
      toggle: document.getElementById('sentimentToggle'),
      sensitivity: document.getElementById('sentimentSensitivity'),
      showTopScorers: document.getElementById('showTopScorers'),
      showBottomScorers: document.getElementById('showBottomScorers'),
      leaderboardDuration: document.getElementById('leaderboardDuration')
    },
    toxicity: {
      toggle: document.getElementById('toxicityToggle'),
      message: document.getElementById('toxicityMessage'),
      modNotification: document.getElementById('toxicityModNotification'),
      selfNotification: document.getElementById('toxicitySelfNotification'),
      modMessage: document.getElementById('toxicityModMessage'),
      selfMessage: document.getElementById('toxicitySelfMessage')
    }
  };
  var themeToggle = document.getElementById('themeToggle');
  var twitchLoginButton = document.getElementById('twitchLoginButton');
  var twitchLogoutButton = document.getElementById('twitchLogoutButton');
  function displayError(message) {
    var errorMessageElement = document.getElementById('error-message');
    errorMessageElement.textContent = message;
    errorMessageElement.style.display = 'block';
    setTimeout(function () {
      errorMessageElement.style.display = 'none';
    }, 5000);
  }

  // Function to load preferences
  function loadPreferences() {
    chrome.runtime.sendMessage({
      type: 'loadPreferences'
    }, function (response) {
      if (response.error) {
        console.error('Error loading preferences:', response.error);
        displayError('Error loading preferences: ' + response.error);
      }
      var decryptedPreferences = response.preferences;
      if (preferences) {
        console.log("Preferences loaded");
        // Set the preferences on the options page
        if (decryptedPreferences.darkMode) {
          document.body.classList.add('dark');
          themeToggle.checked = true;
        } else {
          document.body.classList.remove('dark');
          themeToggle.checked = false;
        }
        for (var feature in decryptedPreferences) {
          if (decryptedPreferences[feature].enabled) {
            features[feature].toggle.checked = true;
          } else {
            features[feature].toggle.checked = false;
          }
          for (var option in decryptedPreferences[feature].options) {
            var input = features[feature][option];
            if (input.type === 'checkbox') {
              input.checked = decryptedPreferences[feature].options[option];
            } else if (input.type === 'range') {
              input.value = decryptedPreferences[feature].options[option];
            } else {
              input.value = decryptedPreferences[feature].options[option];
            }
          }
        }
      }
    });
  }

  // Load the user's preferences when the options page starts
  loadPreferences();

  // Function to save preferences
  function savePreferences() {
    var preferences = {
      darkMode: themeToggle.checked
    };
    for (var feature in features) {
      preferences[feature] = {
        enabled: features[feature].toggle.checked,
        options: {}
      };
      for (var option in features[feature]) {
        if (option !== 'toggle') {
          var input = features[feature][option];
          if (input.type === 'checkbox') {
            preferences[feature].options[option] = input.checked;
          } else {
            preferences[feature].options[option] = input.value;
          }
        }
      }
    }

    // Encrypt the preferences using the encryption key
    var unencryptedPreferences = preferences;

    // Send the encrypted preferences to the background script to save
    chrome.runtime.sendMessage({
      type: 'savePreferences',
      preferences: unencryptedPreferences
    }, function (response) {
      if (response.error) {
        console.error('Error saving preferences:', response.error);
        displayError('Error saving preferences: ' + response.error);
      } else {
        console.log('Preferences saved successfully');
      }
    });
  }
  themeToggle.addEventListener('change', function () {
    if (themeToggle.checked) {
      document.body.classList.add('dark');
    } else {
      document.body.classList.remove('dark');
    }
    savePreferences();
  });
  twitchLoginButton.addEventListener('click', function () {
    // Initiate OAuth flow with Twitch via Netlify function
    chrome.runtime.sendMessage({
      type: 'initiateTwitchOAuth'
    });
  });
  for (var feature in features) {
    features[feature].toggle.addEventListener('change', savePreferences);
    for (var option in features[feature]) {
      if (option !== 'toggle') {
        var input = features[feature][option];
        input.addEventListener('input', function () {
          savePreferences();
        });
      }
    }
  }

  //Check if the user is logged in to Twitch
  chrome.runtime.sendMessage({
    type: 'checkTwitchLogin'
  }, function (data) {
    if (data.error) {
      console.error('Error checking Twitch login:', data.error);
      displayError('Error checking Twitch login: ' + data.error);
    } else if (data.loggedIn) {
      // The user is logged in to Twitch
      // Hide the login button and show the logout button
      twitchLoginButton.style.display = 'none';
      var _twitchLogoutButton = document.createElement('button');
      _twitchLogoutButton.innerText = 'Logout from Twitch';
      document.getElementById('twitchAuth').appendChild(_twitchLogoutButton);
      // Add event listener to logout button
      _twitchLogoutButton.addEventListener('click', function () {
        chrome.runtime.sendMessage({
          type: 'removeTwitchAccessToken'
        }, function (data) {
          if (date.error) {
            console.error('Error removing Twitch access token:', data.error);
            displayError('Error removing Twitch access token: ');
          } else {
            twitchLoginButton.style.display = 'block';
            _twitchLogoutButton.remove();
          }
        });
      });
    }
  });

  // Listen for messages from the background script
  chrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {
    if (request.type === 'warning') {
      displayError(request.message);
    } else if (request.type === 'error') {
      displayError(request.message);
    } else if (request.type === 'success') {
      var successMessageElement = document.getElementById('success-message');
      successMessageElement.textContent = request.message;
      successMessageElement.style.display = 'block';
    } else if (request.type === 'preferences') {
      var _preferences = request.preferences;
      if (_preferences) {
        // Decrypt the preferences using the encryption key
        var decryptedPreferences = _preferences;
        if (decryptedPreferences.darkMode) {
          document.body.classList.add('dark');
          themeToggle.checked = true;
        } else {
          document.body.classList.remove('dark');
          themeToggle.checked = false;
        }
        for (var _feature in decryptedPreferences) {
          if (decryptedPreferences[_feature].enabled) {
            features[_feature].toggle.checked = true;
          } else {
            features[_feature].toggle.checked = false;
          }
          for (var _option in decryptedPreferences[_feature].options) {
            var _input = features[_feature][_option];
            if (_input.type === 'checkbox') {
              _input.checked = decryptedPreferences[_feature].options[_option];
            } else if (_input.type === 'range') {
              _input.value = decryptedPreferences[_feature].options[_option];
            } else {
              _input.value = decryptedPreferences[_feature].options[_option];
            }
          }
        }
      }
    } else {
      throw new Error("Unknown message type: ".concat(request.type));
    }
    return true; // Indicate that the response will be sent asynchronously
  });
});

/* enableSentimentAnalysis = preferences.sentiment.enabled;
enableToxicityDetection = preferences.toxicity.enabled;
sentimentSensitivity = preferences.sentiment.options.sensitivity;
toxicityThreshold = preferences.toxicity.options.threshold;
warningMessageToxic = preferences.toxicity.options.warningMessageToxic;
warningMessageNegative = preferences.toxicity.options.warningMessageNegative;
customMessageToxic = preferences.toxicity.options.customMessageToxic;
customMessageNegative = preferences.toxicity.options.customMessageNegative;
warningToxicUser = preferences.toxicity.options.warningToxicUser;
warningNegativeUser = preferences.toxicity.options.warningNegativeUser;
customMessageToxicUser = preferences.toxicity.options.customMessageToxicUser;
customMessageNegativeUser = preferences.toxicity.options.customMessageNegativeUser;
enableDarkMode = preferences.darkMode;
sentimentLeaderboard = preferences.sentiment.options.showLeaderboard;
toxicityLeaderboard = preferences.toxicity.options.showLeaderboard;
sentimentLeaderboardDuration = preferences.sentiment.options.leaderboardDuration;
toxicityLeaderboardDuration = preferences.toxicity.options.leaderboardDuration;
*/
/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O0FBQ0EsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3N0cmVhbW1hdGV5Ly4vc3JjL29wdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gICAgY29uc3QgZmVhdHVyZXMgPSB7XHJcbiAgICAgICAgc2VudGltZW50OiB7XHJcbiAgICAgICAgICAgIHRvZ2dsZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnRpbWVudFRvZ2dsZScpLFxyXG4gICAgICAgICAgICBzZW5zaXRpdml0eTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbnRpbWVudFNlbnNpdGl2aXR5JyksXHJcbiAgICAgICAgICAgIHNob3dUb3BTY29yZXJzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvd1RvcFNjb3JlcnMnKSxcclxuICAgICAgICAgICAgc2hvd0JvdHRvbVNjb3JlcnM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93Qm90dG9tU2NvcmVycycpLFxyXG4gICAgICAgICAgICBsZWFkZXJib2FyZER1cmF0aW9uOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmREdXJhdGlvbicpXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b3hpY2l0eToge1xyXG4gICAgICAgICAgICB0b2dnbGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3hpY2l0eVRvZ2dsZScpLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG94aWNpdHlNZXNzYWdlJyksXHJcbiAgICAgICAgICAgIG1vZE5vdGlmaWNhdGlvbjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RveGljaXR5TW9kTm90aWZpY2F0aW9uJyksXHJcbiAgICAgICAgICAgIHNlbGZOb3RpZmljYXRpb246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3hpY2l0eVNlbGZOb3RpZmljYXRpb24nKSxcclxuICAgICAgICAgICAgbW9kTWVzc2FnZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RveGljaXR5TW9kTWVzc2FnZScpLFxyXG4gICAgICAgICAgICBzZWxmTWVzc2FnZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RveGljaXR5U2VsZk1lc3NhZ2UnKVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgdGhlbWVUb2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGhlbWVUb2dnbGUnKTtcclxuICAgIGNvbnN0IHR3aXRjaExvZ2luQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3R3aXRjaExvZ2luQnV0dG9uJyk7XHJcbiAgICBjb25zdCB0d2l0Y2hMb2dvdXRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHdpdGNoTG9nb3V0QnV0dG9uJyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZGlzcGxheUVycm9yKG1lc3NhZ2UpIHtcclxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vycm9yLW1lc3NhZ2UnKTtcclxuICAgICAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTtcclxuICAgICAgICBlcnJvck1lc3NhZ2VFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIH1cclxuICAgICAgICAsIDUwMDApO1xyXG4gICAgfVxyXG5cclxuLy8gRnVuY3Rpb24gdG8gbG9hZCBwcmVmZXJlbmNlc1xyXG5mdW5jdGlvbiBsb2FkUHJlZmVyZW5jZXMoKSB7XHJcbiAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7dHlwZTogJ2xvYWRQcmVmZXJlbmNlcyd9LCBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIHByZWZlcmVuY2VzOicsIHJlc3BvbnNlLmVycm9yKTtcclxuICAgICAgICAgICAgZGlzcGxheUVycm9yKCdFcnJvciBsb2FkaW5nIHByZWZlcmVuY2VzOiAnICsgcmVzcG9uc2UuZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBkZWNyeXB0ZWRQcmVmZXJlbmNlcyA9IHJlc3BvbnNlLnByZWZlcmVuY2VzO1xyXG4gICAgICAgIGlmIChwcmVmZXJlbmNlcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJlZmVyZW5jZXMgbG9hZGVkXCIpO1xyXG4gICAgICAgICAgICAvLyBTZXQgdGhlIHByZWZlcmVuY2VzIG9uIHRoZSBvcHRpb25zIHBhZ2VcclxuICAgICAgICAgICAgaWYgKGRlY3J5cHRlZFByZWZlcmVuY2VzLmRhcmtNb2RlKSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2RhcmsnKTtcclxuICAgICAgICAgICAgICAgIHRoZW1lVG9nZ2xlLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdkYXJrJyk7XHJcbiAgICAgICAgICAgICAgICB0aGVtZVRvZ2dsZS5jaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGZlYXR1cmUgaW4gZGVjcnlwdGVkUHJlZmVyZW5jZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkZWNyeXB0ZWRQcmVmZXJlbmNlc1tmZWF0dXJlXS5lbmFibGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNbZmVhdHVyZV0udG9nZ2xlLmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1tmZWF0dXJlXS50b2dnbGUuY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG9wdGlvbiBpbiBkZWNyeXB0ZWRQcmVmZXJlbmNlc1tmZWF0dXJlXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0ID0gZmVhdHVyZXNbZmVhdHVyZV1bb3B0aW9uXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gZGVjcnlwdGVkUHJlZmVyZW5jZXNbZmVhdHVyZV0ub3B0aW9uc1tvcHRpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5wdXQudHlwZSA9PT0gJ3JhbmdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGRlY3J5cHRlZFByZWZlcmVuY2VzW2ZlYXR1cmVdLm9wdGlvbnNbb3B0aW9uXTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGRlY3J5cHRlZFByZWZlcmVuY2VzW2ZlYXR1cmVdLm9wdGlvbnNbb3B0aW9uXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gTG9hZCB0aGUgdXNlcidzIHByZWZlcmVuY2VzIHdoZW4gdGhlIG9wdGlvbnMgcGFnZSBzdGFydHNcclxubG9hZFByZWZlcmVuY2VzKCk7XHJcblxyXG4vLyBGdW5jdGlvbiB0byBzYXZlIHByZWZlcmVuY2VzXHJcbiAgICBmdW5jdGlvbiBzYXZlUHJlZmVyZW5jZXMoKSB7XHJcbiAgICAgICAgbGV0IHByZWZlcmVuY2VzID0ge1xyXG4gICAgICAgICAgICBkYXJrTW9kZTogdGhlbWVUb2dnbGUuY2hlY2tlZFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZvciAobGV0IGZlYXR1cmUgaW4gZmVhdHVyZXMpIHtcclxuICAgICAgICAgICAgcHJlZmVyZW5jZXNbZmVhdHVyZV0gPSB7XHJcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBmZWF0dXJlc1tmZWF0dXJlXS50b2dnbGUuY2hlY2tlZCxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IHt9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCBvcHRpb24gaW4gZmVhdHVyZXNbZmVhdHVyZV0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb24gIT09ICd0b2dnbGUnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGlucHV0ID0gZmVhdHVyZXNbZmVhdHVyZV1bb3B0aW9uXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmVmZXJlbmNlc1tmZWF0dXJlXS5vcHRpb25zW29wdGlvbl0gPSBpbnB1dC5jaGVja2VkO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZWZlcmVuY2VzW2ZlYXR1cmVdLm9wdGlvbnNbb3B0aW9uXSA9IGlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRW5jcnlwdCB0aGUgcHJlZmVyZW5jZXMgdXNpbmcgdGhlIGVuY3J5cHRpb24ga2V5XHJcbiAgICAgICAgY29uc3QgdW5lbmNyeXB0ZWRQcmVmZXJlbmNlcyA9IHByZWZlcmVuY2VzO1xyXG5cclxuICAgICAgICAvLyBTZW5kIHRoZSBlbmNyeXB0ZWQgcHJlZmVyZW5jZXMgdG8gdGhlIGJhY2tncm91bmQgc2NyaXB0IHRvIHNhdmVcclxuICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7dHlwZTogJ3NhdmVQcmVmZXJlbmNlcycsIHByZWZlcmVuY2VzOiB1bmVuY3J5cHRlZFByZWZlcmVuY2VzfSwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgcHJlZmVyZW5jZXM6JywgcmVzcG9uc2UuZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheUVycm9yKCdFcnJvciBzYXZpbmcgcHJlZmVyZW5jZXM6ICcgKyByZXNwb25zZS5lcnJvcik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnUHJlZmVyZW5jZXMgc2F2ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIHRoZW1lVG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGVtZVRvZ2dsZS5jaGVja2VkKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZGFyaycpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZGFyaycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzYXZlUHJlZmVyZW5jZXMoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHR3aXRjaExvZ2luQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIC8vIEluaXRpYXRlIE9BdXRoIGZsb3cgd2l0aCBUd2l0Y2ggdmlhIE5ldGxpZnkgZnVuY3Rpb25cclxuICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7dHlwZTogJ2luaXRpYXRlVHdpdGNoT0F1dGgnfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3IgKGxldCBmZWF0dXJlIGluIGZlYXR1cmVzKSB7XHJcbiAgICAgICAgZmVhdHVyZXNbZmVhdHVyZV0udG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHNhdmVQcmVmZXJlbmNlcyk7XHJcbiAgICAgICAgZm9yIChsZXQgb3B0aW9uIGluIGZlYXR1cmVzW2ZlYXR1cmVdKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb24gIT09ICd0b2dnbGUnKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSBmZWF0dXJlc1tmZWF0dXJlXVtvcHRpb25dO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVByZWZlcmVuY2VzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbi8vQ2hlY2sgaWYgdGhlIHVzZXIgaXMgbG9nZ2VkIGluIHRvIFR3aXRjaFxyXG4gICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2Uoe3R5cGU6ICdjaGVja1R3aXRjaExvZ2luJ30sIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YS5lcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjaGVja2luZyBUd2l0Y2ggbG9naW46JywgZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgIGRpc3BsYXlFcnJvcignRXJyb3IgY2hlY2tpbmcgVHdpdGNoIGxvZ2luOiAnICsgZGF0YS5lcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhLmxvZ2dlZEluKSB7XHJcbiAgICAgICAgICAgIC8vIFRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB0byBUd2l0Y2hcclxuICAgICAgICAgICAgLy8gSGlkZSB0aGUgbG9naW4gYnV0dG9uIGFuZCBzaG93IHRoZSBsb2dvdXQgYnV0dG9uXHJcbiAgICAgICAgICAgIHR3aXRjaExvZ2luQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIGxldCB0d2l0Y2hMb2dvdXRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcclxuICAgICAgICAgICAgdHdpdGNoTG9nb3V0QnV0dG9uLmlubmVyVGV4dCA9ICdMb2dvdXQgZnJvbSBUd2l0Y2gnO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHdpdGNoQXV0aCcpLmFwcGVuZENoaWxkKHR3aXRjaExvZ291dEJ1dHRvbik7XHJcbiAgICAgICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciB0byBsb2dvdXQgYnV0dG9uXHJcbiAgICAgICAgICAgIHR3aXRjaExvZ291dEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHt0eXBlOiAncmVtb3ZlVHdpdGNoQWNjZXNzVG9rZW4nfSwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRlLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlbW92aW5nIFR3aXRjaCBhY2Nlc3MgdG9rZW46JywgZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlFcnJvcignRXJyb3IgcmVtb3ZpbmcgVHdpdGNoIGFjY2VzcyB0b2tlbjogJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHdpdGNoTG9naW5CdXR0b24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR3aXRjaExvZ291dEJ1dHRvbi5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gTGlzdGVuIGZvciBtZXNzYWdlcyBmcm9tIHRoZSBiYWNrZ3JvdW5kIHNjcmlwdFxyXG4gICAgY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChyZXF1ZXN0LCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICBpZiAocmVxdWVzdC50eXBlID09PSAnd2FybmluZycpIHtcclxuICAgICAgICAgICAgZGlzcGxheUVycm9yKHJlcXVlc3QubWVzc2FnZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnR5cGUgPT09ICdlcnJvcicpIHtcclxuICAgICAgICAgICAgZGlzcGxheUVycm9yKHJlcXVlc3QubWVzc2FnZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnR5cGUgPT09ICdzdWNjZXNzJykge1xyXG4gICAgICAgICAgICBjb25zdCBzdWNjZXNzTWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VjY2Vzcy1tZXNzYWdlJyk7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IHJlcXVlc3QubWVzc2FnZTtcclxuICAgICAgICAgICAgc3VjY2Vzc01lc3NhZ2VFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdC50eXBlID09PSAncHJlZmVyZW5jZXMnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gcmVxdWVzdC5wcmVmZXJlbmNlcztcclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBpZiAocHJlZmVyZW5jZXMpIHtcclxuICAgICAgICAgICAgICAgIC8vIERlY3J5cHQgdGhlIHByZWZlcmVuY2VzIHVzaW5nIHRoZSBlbmNyeXB0aW9uIGtleVxyXG4gICAgICAgICAgICAgICAgY29uc3QgZGVjcnlwdGVkUHJlZmVyZW5jZXMgPSBwcmVmZXJlbmNlcztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZGVjcnlwdGVkUHJlZmVyZW5jZXMuZGFya01vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2RhcmsnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGVtZVRvZ2dsZS5jaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdkYXJrJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhlbWVUb2dnbGUuY2hlY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGZlYXR1cmUgaW4gZGVjcnlwdGVkUHJlZmVyZW5jZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGVjcnlwdGVkUHJlZmVyZW5jZXNbZmVhdHVyZV0uZW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlc1tmZWF0dXJlXS50b2dnbGUuY2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXNbZmVhdHVyZV0udG9nZ2xlLmNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG9wdGlvbiBpbiBkZWNyeXB0ZWRQcmVmZXJlbmNlc1tmZWF0dXJlXS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpbnB1dCA9IGZlYXR1cmVzW2ZlYXR1cmVdW29wdGlvbl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnB1dC50eXBlID09PSAnY2hlY2tib3gnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jaGVja2VkID0gZGVjcnlwdGVkUHJlZmVyZW5jZXNbZmVhdHVyZV0ub3B0aW9uc1tvcHRpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlucHV0LnR5cGUgPT09ICdyYW5nZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gZGVjcnlwdGVkUHJlZmVyZW5jZXNbZmVhdHVyZV0ub3B0aW9uc1tvcHRpb25dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBkZWNyeXB0ZWRQcmVmZXJlbmNlc1tmZWF0dXJlXS5vcHRpb25zW29wdGlvbl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gbWVzc2FnZSB0eXBlOiAke3JlcXVlc3QudHlwZX1gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlOyAvLyBJbmRpY2F0ZSB0aGF0IHRoZSByZXNwb25zZSB3aWxsIGJlIHNlbnQgYXN5bmNocm9ub3VzbHlcclxuXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG4vKiBlbmFibGVTZW50aW1lbnRBbmFseXNpcyA9IHByZWZlcmVuY2VzLnNlbnRpbWVudC5lbmFibGVkO1xyXG5lbmFibGVUb3hpY2l0eURldGVjdGlvbiA9IHByZWZlcmVuY2VzLnRveGljaXR5LmVuYWJsZWQ7XHJcbnNlbnRpbWVudFNlbnNpdGl2aXR5ID0gcHJlZmVyZW5jZXMuc2VudGltZW50Lm9wdGlvbnMuc2Vuc2l0aXZpdHk7XHJcbnRveGljaXR5VGhyZXNob2xkID0gcHJlZmVyZW5jZXMudG94aWNpdHkub3B0aW9ucy50aHJlc2hvbGQ7XHJcbndhcm5pbmdNZXNzYWdlVG94aWMgPSBwcmVmZXJlbmNlcy50b3hpY2l0eS5vcHRpb25zLndhcm5pbmdNZXNzYWdlVG94aWM7XHJcbndhcm5pbmdNZXNzYWdlTmVnYXRpdmUgPSBwcmVmZXJlbmNlcy50b3hpY2l0eS5vcHRpb25zLndhcm5pbmdNZXNzYWdlTmVnYXRpdmU7XHJcbmN1c3RvbU1lc3NhZ2VUb3hpYyA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMuY3VzdG9tTWVzc2FnZVRveGljO1xyXG5jdXN0b21NZXNzYWdlTmVnYXRpdmUgPSBwcmVmZXJlbmNlcy50b3hpY2l0eS5vcHRpb25zLmN1c3RvbU1lc3NhZ2VOZWdhdGl2ZTtcclxud2FybmluZ1RveGljVXNlciA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMud2FybmluZ1RveGljVXNlcjtcclxud2FybmluZ05lZ2F0aXZlVXNlciA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMud2FybmluZ05lZ2F0aXZlVXNlcjtcclxuY3VzdG9tTWVzc2FnZVRveGljVXNlciA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMuY3VzdG9tTWVzc2FnZVRveGljVXNlcjtcclxuY3VzdG9tTWVzc2FnZU5lZ2F0aXZlVXNlciA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMuY3VzdG9tTWVzc2FnZU5lZ2F0aXZlVXNlcjtcclxuZW5hYmxlRGFya01vZGUgPSBwcmVmZXJlbmNlcy5kYXJrTW9kZTtcclxuc2VudGltZW50TGVhZGVyYm9hcmQgPSBwcmVmZXJlbmNlcy5zZW50aW1lbnQub3B0aW9ucy5zaG93TGVhZGVyYm9hcmQ7XHJcbnRveGljaXR5TGVhZGVyYm9hcmQgPSBwcmVmZXJlbmNlcy50b3hpY2l0eS5vcHRpb25zLnNob3dMZWFkZXJib2FyZDtcclxuc2VudGltZW50TGVhZGVyYm9hcmREdXJhdGlvbiA9IHByZWZlcmVuY2VzLnNlbnRpbWVudC5vcHRpb25zLmxlYWRlcmJvYXJkRHVyYXRpb247XHJcbnRveGljaXR5TGVhZGVyYm9hcmREdXJhdGlvbiA9IHByZWZlcmVuY2VzLnRveGljaXR5Lm9wdGlvbnMubGVhZGVyYm9hcmREdXJhdGlvbjtcclxuKi9cclxuXHJcbiJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImZlYXR1cmVzIiwic2VudGltZW50IiwidG9nZ2xlIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZW5zaXRpdml0eSIsInNob3dUb3BTY29yZXJzIiwic2hvd0JvdHRvbVNjb3JlcnMiLCJsZWFkZXJib2FyZER1cmF0aW9uIiwidG94aWNpdHkiLCJtZXNzYWdlIiwibW9kTm90aWZpY2F0aW9uIiwic2VsZk5vdGlmaWNhdGlvbiIsIm1vZE1lc3NhZ2UiLCJzZWxmTWVzc2FnZSIsInRoZW1lVG9nZ2xlIiwidHdpdGNoTG9naW5CdXR0b24iLCJ0d2l0Y2hMb2dvdXRCdXR0b24iLCJkaXNwbGF5RXJyb3IiLCJlcnJvck1lc3NhZ2VFbGVtZW50IiwidGV4dENvbnRlbnQiLCJzdHlsZSIsImRpc3BsYXkiLCJzZXRUaW1lb3V0IiwibG9hZFByZWZlcmVuY2VzIiwiY2hyb21lIiwicnVudGltZSIsInNlbmRNZXNzYWdlIiwidHlwZSIsInJlc3BvbnNlIiwiZXJyb3IiLCJjb25zb2xlIiwiZGVjcnlwdGVkUHJlZmVyZW5jZXMiLCJwcmVmZXJlbmNlcyIsImxvZyIsImRhcmtNb2RlIiwiYm9keSIsImNsYXNzTGlzdCIsImFkZCIsImNoZWNrZWQiLCJyZW1vdmUiLCJmZWF0dXJlIiwiZW5hYmxlZCIsIm9wdGlvbiIsIm9wdGlvbnMiLCJpbnB1dCIsInZhbHVlIiwic2F2ZVByZWZlcmVuY2VzIiwidW5lbmNyeXB0ZWRQcmVmZXJlbmNlcyIsImRhdGEiLCJsb2dnZWRJbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lclRleHQiLCJhcHBlbmRDaGlsZCIsImRhdGUiLCJvbk1lc3NhZ2UiLCJhZGRMaXN0ZW5lciIsInJlcXVlc3QiLCJzZW5kZXIiLCJzZW5kUmVzcG9uc2UiLCJzdWNjZXNzTWVzc2FnZUVsZW1lbnQiLCJFcnJvciIsImNvbmNhdCJdLCJzb3VyY2VSb290IjoiIn0=